{"ast":null,"code":"import { onMounted, ref, watch, toRefs, reactive } from \"vue\";\nimport { getCategoryNoPage } from \"../../../../network/category\";\nimport { insertGood } from \"../../../../network/good\";\nexport default {\n  name: \"salerInsertGood\",\n\n  setup() {\n    let insertSuccess = ref(false);\n    let insertFailed = ref(false);\n    let items = ref([]);\n    let form = reactive({\n      name: \"\",\n      category: \"\",\n      intro: \"\"\n    });\n    let valid = true;\n    let nameRules = [v => !!v || 'Name is required', v => v && v.length <= 10 || 'Name must be less than 10 characters'];\n    let itemdict = {}; //category的id和item相对应的dict\n\n    const init = () => {\n      getCategoryNoPage().then(res => {\n        res.data.forEach((v, i) => {\n          items.value.push(v.item);\n          itemdict[v.item] = v.id;\n        });\n      });\n    };\n\n    onMounted(() => {\n      init();\n    });\n\n    const validate = () => {\n      // let sendForm = reactive({\n      //   name: form.name,\n      //   category_id: itemdict[form.category],\n      //   intro: form.intro,\n      // })\n      let formData = new window.FormData();\n      formData.append(\"name\", form.name);\n      formData.append(\"category_id\", itemdict[form.category]);\n      formData.append(\"intro\", form.intro);\n      formData.append(\"pic\", document.getElementById(\"input\").files[0]);\n      insertGood(formData).then(res => {\n        let status = res.data.status;\n\n        if (status === 1) {\n          insertSuccess.value = true;\n          setTimeout(() => {\n            insertSuccess.value = false;\n          }, 1000);\n        } else {\n          insertFailed.value = true;\n          setTimeout(() => {\n            insertFailed.value = false;\n          }, 1000);\n        }\n\n        form.name = \"\";\n        form.category = \"\";\n        form.intro = \"\";\n      });\n    };\n\n    return {\n      insertSuccess,\n      insertFailed,\n      ...toRefs(form),\n      valid,\n      nameRules,\n      validate,\n      items\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["onMounted","ref","watch","toRefs","reactive","getCategoryNoPage","insertGood","name","setup","insertSuccess","insertFailed","items","form","category","intro","valid","nameRules","v","length","itemdict","init","then","res","data","forEach","i","value","push","item","id","validate","formData","window","FormData","append","document","getElementById","files","status","setTimeout"],"sourceRoot":"","sources":["C:\\Users\\tpmp1\\Desktop\\vue-project\\minishop\\src\\views\\back\\saler\\salerInsertGood.vue"],"sourcesContent":["<template>\r\n  <v-card style=\"height: 200px;\" color=\"#4480A6\">\r\n    <v-card-title class=\"text-h4 font-weight-black text-white mt-6 ml-4\">商品增加</v-card-title>\r\n    <v-card-subtitle class=\"text-h6 font-weight-black text-white mt-4 ml-4\">\r\n      在此可以增加商品信息<br>\r\n      注意：想要增加商品图片，在增加商品后在编辑介面进行\r\n    </v-card-subtitle>\r\n    <v-card-text>\r\n      <v-btn\r\n          color=\"#263F73\"\r\n          class=\"font-weight-black text-white mt-2 ml-4\"\r\n          plain\r\n          @click=\"validate\"\r\n      >\r\n        <v-icon>mdi-account-plus</v-icon>\r\n        增加商品\r\n      </v-btn>\r\n    </v-card-text>\r\n  </v-card>\r\n  <v-card class=\"mt-6\">\r\n    <v-form\r\n        v-model=\"valid\"\r\n        lazy-validation\r\n        class=\"ma-6\"\r\n    >\r\n      <v-text-field\r\n          v-model=\"name\"\r\n          :counter=\"10\"\r\n          :rules=\"nameRules\"\r\n          label=\"Name\"\r\n          required\r\n      ></v-text-field>\r\n      <v-text-field\r\n          v-model=\"intro\"\r\n          label=\"Intro\"\r\n          required\r\n      ></v-text-field>\r\n      <v-autocomplete\r\n          v-model=\"category\"\r\n          :items=\"items\"\r\n          dense\r\n          filled\r\n          label=\"Filled\"\r\n      ></v-autocomplete>\r\n      <v-file-input\r\n          label=\"File input\"\r\n          filled\r\n          prepend-icon=\"mdi-camera\"\r\n          show-size\r\n          chips\r\n          id=\"input\"\r\n      ></v-file-input>\r\n    </v-form>\r\n  </v-card>\r\n  <v-snackbar v-model=\"insertSuccess\">增加成功</v-snackbar>\r\n  <v-snackbar v-model=\"insertFailed\">增加失败</v-snackbar>\r\n</template>\r\n\r\n<script>\r\nimport {onMounted, ref, watch, toRefs, reactive} from \"vue\";\r\nimport { getCategoryNoPage } from \"../../../../network/category\"\r\nimport {insertGood} from \"../../../../network/good\";\r\n\r\nexport default {\r\n  name: \"salerInsertGood\",\r\n  setup() {\r\n    let insertSuccess = ref(false);\r\n    let insertFailed = ref(false);\r\n    let items = ref([])\r\n    let form = reactive({\r\n      name: \"\",\r\n      category: \"\",\r\n      intro: \"\",\r\n    })\r\n\r\n    let valid = true\r\n    let nameRules = [\r\n      v => !!v || 'Name is required',\r\n      v => (v && v.length <= 10) || 'Name must be less than 10 characters',\r\n    ]\r\n\r\n    let itemdict = {} //category的id和item相对应的dict\r\n\r\n    const init = () => {\r\n      getCategoryNoPage().then(res=>{\r\n        res.data.forEach((v, i)=>{\r\n          items.value.push(v.item)\r\n          itemdict[v.item] = v.id;\r\n        })\r\n      })\r\n    }\r\n\r\n    onMounted(()=>{\r\n      init();\r\n    })\r\n\r\n    const validate = () => {\r\n      // let sendForm = reactive({\r\n      //   name: form.name,\r\n      //   category_id: itemdict[form.category],\r\n      //   intro: form.intro,\r\n      // })\r\n      let formData = new window.FormData();\r\n      formData.append(\"name\", form.name);\r\n      formData.append(\"category_id\", itemdict[form.category]);\r\n      formData.append(\"intro\", form.intro);\r\n      formData.append(\"pic\", document.getElementById(\"input\").files[0])\r\n      insertGood(formData).then(res=>{\r\n        let status = res.data.status;\r\n        if (status === 1) {\r\n          insertSuccess.value = true;\r\n          setTimeout(()=>{\r\n            insertSuccess.value = false;\r\n          }, 1000)\r\n        } else {\r\n          insertFailed.value = true;\r\n          setTimeout(()=>{\r\n            insertFailed.value = false;\r\n          }, 1000)\r\n        }\r\n        form.name = \"\"\r\n        form.category = \"\"\r\n        form.intro = \"\"\r\n      })\r\n    }\r\n    return {\r\n      insertSuccess,\r\n      insertFailed,\r\n      ...toRefs(form),\r\n      valid,\r\n      nameRules,\r\n      validate,\r\n      items\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}