{"ast":null,"code":"import { useRoute } from \"vue-router\";\nimport { onMounted, reactive, ref, toRefs } from \"vue\";\nimport { getSalerById } from \"../../../../network/saler\";\nimport { getGoodById, updateGood, uploadGoodImg } from \"../../../../network/good\";\nimport { getCategoryNoPage } from \"../../../../network/category\";\nexport default {\n  name: \"salerEditGood\",\n\n  setup() {\n    let route = useRoute();\n    let updateSuccess = ref(false);\n    let updateFailed = ref(false);\n    let img;\n    let itemdict = {}; //category的id和item相对应的dict\n\n    let form = reactive({\n      id: \"\",\n      name: \"\",\n      category: \"\",\n      intro: \"\"\n    });\n    form.id = route.query.id;\n    let items = ref([]);\n    let valid = true;\n    let nameRules = [v => !!v || 'Name is required', v => v && v.length <= 10 || 'Name must be less than 10 characters'];\n\n    const validate = () => {\n      let sendform = {\n        id: form.id,\n        name: form.name,\n        category_id: itemdict[form.category],\n        intro: form.intro\n      };\n      console.log(sendform);\n      updateGood(sendform).then(res => {\n        let status = res.data.status;\n\n        if (status >= 1) {\n          if (document.getElementById(\"input\").files[0] == null) {\n            updateSuccess.value = true;\n            setTimeout(() => {\n              updateSuccess.value = false;\n            }, 1000);\n            return;\n          }\n\n          let formData = new window.FormData();\n          formData.append(\"fileid\", form.id);\n          formData.append(\"file\", document.getElementById(\"input\").files[0]);\n          uploadGoodImg(formData).then(res => {\n            let imgStatus = res.data.status;\n\n            if (imgStatus === 1) {\n              updateSuccess.value = true;\n              setTimeout(() => {\n                updateSuccess.value = false;\n              }, 1000);\n            } else {\n              updateFailed.value = true;\n              setTimeout(() => {\n                updateFailed.value = false;\n              }, 1000);\n            }\n          });\n        } else {\n          updateFailed.value = true;\n          setTimeout(() => {\n            updateFailed.value = false;\n          }, 1000);\n        }\n\n        init();\n      });\n    };\n\n    const init = () => {\n      getGoodById(form.id).then(res => {\n        form.name = res.data.name;\n        form.item = res.data.item;\n        form.intro = res.data.intro;\n      });\n      getCategoryNoPage().then(res => {\n        res.data.forEach((v, i) => {\n          items.value.push(v.item);\n          itemdict[v.item] = v.id;\n        });\n      });\n      img = \"http://localhost:8081/updateSalerImg/\" + form.id;\n    };\n\n    onMounted(() => {\n      init();\n    });\n    return {\n      valid,\n      nameRules,\n      ...toRefs(form),\n      validate,\n      updateSuccess,\n      updateFailed,\n      //submitFiles,\n      img,\n      items\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["useRoute","onMounted","reactive","ref","toRefs","getSalerById","getGoodById","updateGood","uploadGoodImg","getCategoryNoPage","name","setup","route","updateSuccess","updateFailed","img","itemdict","form","id","category","intro","query","items","valid","nameRules","v","length","validate","sendform","category_id","console","log","then","res","status","data","document","getElementById","files","value","setTimeout","formData","window","FormData","append","imgStatus","init","item","forEach","i","push"],"sourceRoot":"","sources":["C:\\Users\\tpmp1\\Desktop\\vue-project\\minishop\\src\\views\\back\\saler\\salerEditGood.vue"],"sourcesContent":["<template>\r\n  <v-card style=\"height: 200px;\" color=\"#4480A6\">\r\n    <v-card-title class=\"text-h4 font-weight-black text-white mt-6 ml-4\">商品更新</v-card-title>\r\n    <v-card-subtitle class=\"text-h6 font-weight-black text-white mt-4 ml-4\">\r\n      在此可以增加商品信息<br>\r\n      注意：想要增加商品图片，在增加商品后在编辑介面进行\r\n    </v-card-subtitle>\r\n    <v-card-text>\r\n      <v-btn\r\n          color=\"#263F73\"\r\n          class=\"font-weight-black text-white mt-2 ml-4\"\r\n          plain\r\n          @click=\"validate\"\r\n      >\r\n        <v-icon>mdi-account-plus</v-icon>\r\n        更新商品\r\n      </v-btn>\r\n<!--      <v-btn-->\r\n<!--          color=\"#263F73\"-->\r\n<!--          class=\"font-weight-black text-white mt-2 ml-4\"-->\r\n<!--          plain-->\r\n<!--          @click=\"submitFiles\"-->\r\n<!--      >-->\r\n<!--        <v-icon>mdi-account-plus</v-icon>-->\r\n<!--        上传图片-->\r\n<!--      </v-btn>-->\r\n    </v-card-text>\r\n  </v-card>\r\n  <v-card class=\"mt-6\">\r\n    <v-form\r\n        v-model=\"valid\"\r\n        lazy-validation\r\n        class=\"ma-6\"\r\n    >\r\n      <v-text-field\r\n          v-model=\"name\"\r\n          :counter=\"10\"\r\n          :rules=\"nameRules\"\r\n          label=\"Name\"\r\n          required\r\n      ></v-text-field>\r\n      <v-text-field\r\n          v-model=\"intro\"\r\n          label=\"intro\"\r\n          required\r\n      ></v-text-field>\r\n      <v-autocomplete\r\n          v-model=\"category\"\r\n          :items=\"items\"\r\n          dense\r\n          filled\r\n          label=\"Category\"\r\n      ></v-autocomplete>\r\n      <v-file-input\r\n          label=\"File input\"\r\n          filled\r\n          prepend-icon=\"mdi-camera\"\r\n          show-size\r\n          chips\r\n          id=\"input\"\r\n      ></v-file-input>\r\n      <v-avatar\r\n          size=\"50px\"\r\n      >\r\n        <v-img\r\n            alt=\"Avatar\"\r\n            :src=\"'http://localhost:8081/queryGoodImg/'+ id\"\r\n            id=\"avatar\"\r\n        ></v-img>\r\n      </v-avatar>\r\n    </v-form>\r\n\r\n\r\n  </v-card>\r\n  <v-snackbar v-model=\"updateSuccess\">更新成功</v-snackbar>\r\n  <v-snackbar v-model=\"updateFailed\">更新失败</v-snackbar>\r\n</template>\r\n\r\n<script>\r\nimport {useRoute} from \"vue-router\";\r\nimport {onMounted, reactive, ref, toRefs} from \"vue\";\r\nimport {getSalerById} from \"../../../../network/saler\";\r\nimport {getGoodById, updateGood, uploadGoodImg} from \"../../../../network/good\";\r\nimport {getCategoryNoPage} from \"../../../../network/category\";\r\n\r\nexport default {\r\n  name: \"salerEditGood\",\r\n  setup() {\r\n    let route = useRoute();\r\n    let updateSuccess = ref(false);\r\n    let updateFailed = ref(false);\r\n\r\n    let img;\r\n\r\n    let itemdict = {} //category的id和item相对应的dict\r\n\r\n    let form = reactive({\r\n      id: \"\",\r\n      name: \"\",\r\n      category: \"\",\r\n      intro: \"\",\r\n    })\r\n\r\n    form.id = route.query.id;\r\n\r\n    let items = ref([])\r\n\r\n    let valid = true\r\n    let nameRules = [\r\n      v => !!v || 'Name is required',\r\n      v => (v && v.length <= 10) || 'Name must be less than 10 characters',\r\n    ]\r\n\r\n    const validate = () => {\r\n\r\n      let sendform = {\r\n        id: form.id,\r\n        name: form.name,\r\n        category_id: itemdict[form.category],\r\n        intro: form.intro,\r\n      }\r\n\r\n      console.log(sendform);\r\n\r\n      updateGood(sendform).then(res=>{\r\n        let status = res.data.status\r\n        if (status >= 1) {\r\n\r\n          if (document.getElementById(\"input\").files[0] == null) {\r\n            updateSuccess.value = true\r\n            setTimeout(()=>{\r\n              updateSuccess.value = false\r\n            },1000)\r\n            return\r\n          }\r\n\r\n          let formData = new window.FormData();\r\n          formData.append(\"fileid\", form.id)\r\n          formData.append(\"file\", document.getElementById(\"input\").files[0])\r\n          uploadGoodImg(formData).then(res=>{\r\n            let imgStatus = res.data.status;\r\n            if (imgStatus === 1) {\r\n              updateSuccess.value = true\r\n              setTimeout(()=>{\r\n                updateSuccess.value = false\r\n              },1000)\r\n            } else {\r\n              updateFailed.value = true\r\n              setTimeout(()=>{\r\n                updateFailed.value = false\r\n              },1000)\r\n            }\r\n          })\r\n\r\n        } else {\r\n          updateFailed.value = true\r\n          setTimeout(()=>{\r\n            updateFailed.value = false\r\n          },1000)\r\n        }\r\n        init()\r\n      })\r\n    }\r\n\r\n    const init = () => {\r\n\r\n      getGoodById(form.id).then(res=>{\r\n        form.name = res.data.name;\r\n        form.item = res.data.item;\r\n        form.intro = res.data.intro;\r\n      })\r\n\r\n      getCategoryNoPage().then(res=>{\r\n        res.data.forEach((v, i)=>{\r\n          items.value.push(v.item)\r\n          itemdict[v.item] = v.id;\r\n        })\r\n      })\r\n\r\n      img = \"http://localhost:8081/updateSalerImg/\" + form.id\r\n\r\n    }\r\n\r\n    onMounted(()=>{\r\n      init()\r\n    })\r\n\r\n    return {\r\n      valid,\r\n      nameRules,\r\n      ...toRefs(form),\r\n      validate,\r\n      updateSuccess,\r\n      updateFailed,\r\n      //submitFiles,\r\n      img,\r\n      items,\r\n    }\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}